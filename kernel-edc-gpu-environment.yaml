name: kernel-edc-gpu
channels:
  - pytorch
  - conda-forge
  - defaults
dependencies:
  # platform basic requirement
  - ipykernel=5.3.4

  # from jupyter/scipy-notebook
  - 'beautifulsoup4=4.9.*'
  - 'conda-forge::blas=*=openblas'
  - 'bokeh=2.1.*'
  - 'bottleneck=1.3.*'
  - 'cloudpickle=1.5.*'
  - 'cython=0.29.*'
  - 'dask=2.20.*'
  - 'dill=0.3.*'
  - 'h5py=2.10.*'
  - 'hdf5=1.10.*'
  - 'ipywidgets=7.5.*'
  - 'ipympl=0.5.*'
  - 'matplotlib-base=3.2.*'
  - 'numba=0.48.*'
  - 'numexpr=2.7.*'
  - 'pandas=1.0.*'
  - 'patsy=0.5.*'
  - 'protobuf=3.12.*'
  - 'pytables=3.6.*'
  - 'scikit-image=0.17.*'
  - 'scikit-learn=0.23.*'
  - 'scipy=1.5.*'
  - 'seaborn=0.10.*'
  - 'sqlalchemy=1.3.*'
  - 'statsmodels=0.11.*'
  - 'sympy=1.6.*'
  - 'vincent=0.4.*'
  - 'xlrd=1.2.*'

  # edc platform
  - pyyaml
  - setuptools
  - cmake
  - cffi
  - python-dotenv
  - oauthlib
  - requests-oauthlib
  - gdal
  - fiona
  - rasterio
  - shapely
  - xarray
  - zarr
  - psycopg2
  - geopandas=0.6.1
  - geojson
  - ipyleaflet
  - cartopy
  - tqdm
  - lightgbm
  - graphviz
  - numba
  - llvmlite
  - descartes
  - nbdime
  - papermill
  - s3fs
  - netcdf4
  - nteract-scrapbook
  - pip
  - pip:
    - git+https://github.com/eurodatacube/papermill-kubernetes-job-progess@1d0490d7df0d9e987a6baec4fa5e7d3cf3c3df63

  - xcube==0.5.1
  - xcube_geodb==0.1.10
  - pip:
    - eo-learn==0.7.2
    - git+https://github.com/dcs4cop/xcube-sh@95c89e6cb3fc3023582855a65894191d25b80a85
    - git+https://github.com/dcs4cop/xcube-gen@104e310324f8affe4cd7f002efc04b8426b5bf8a

  # gpu libs
  - 'tensorflow-gpu=2.1*'
  - keras-gpu
  - pytorch
  - torchvision
  - cudatoolkit=10.1
  # NOTE: this downgrade is necessary because the dependency spec of tensorflow-gpu=2.1 is broken:
  #   https://github.com/tensorflow/tensorflow/issues/40422
  - tensorflow-estimator==2.1.0

  # NOTE: conda fails to calculate the dependency versions within docker-hub resource constraints.
  #       locally it takes > 30 min with > 3.7 GB mem.
  #       this is a known issue and conda refuses to fix it:
  #       https://github.com/conda/conda/issues/5003
  #       these requirements here are only meant to guide conda to one possible configuration, i.e.
  #       please update/remove for future base image updates.
  - pytorch==1.4.0=py3.7_cuda10.1.243_cudnn7.6.3_0
  - keras-gpu=2.3.1=0
  - torchvision=0.5.0=py37_cu101
  - numpy=1.19.1=py37h7ea13bd_2
  - ipython=7.18.1=py37hc6149b9_0
  - hdf5=1.10.5=nompi_h3c11f04_1104
  - fiona=1.8.9.post2=py37hdff7cfa_0
  - python=3.7.8=h6f2ec95_1_cpython


  # rhea group
  - imutils
  - addict
  - yapf
  - lxml
  - pip:
    - wget

  # rhea group GPU only
  - pip:
    - mmcv==0.5.9
