ARG BASE_CONTAINER=jupyter/scipy-notebook:7a3e968dd212
FROM $BASE_CONTAINER

USER root

RUN sed -i -e 's:(groups):(groups 2>/dev/null):' /etc/bash.bashrc

USER $NB_UID

RUN pip uninstall scikit-image -y && \
    conda install --quiet --yes -c conda-forge oauthlib gdal fiona rasterio shapely xarray zarr psycopg2 geopandas geojson ipyleaflet cartopy tqdm lightgbm graphviz numba llvmlite descartes && \
    conda clean --all -f -y && \
    fix-permissions $CONDA_DIR && \
    jupyter labextension install @jupyterlab/geojson-extension && \
    pip install python-dotenv && \
    pip install requests_oauthlib && \
    pip install eo-learn==0.7.2 && \
    pip install git+https://github.com/dcs4cop/xcube && \
    pip install git+https://github.com/dcs4cop/xcube-sh && \
    pip install git+https://github.com/dcs4cop/xcube-geodb && \    
    fix-permissions /home/$NB_USER